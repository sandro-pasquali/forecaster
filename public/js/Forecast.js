(function() {

    var cover = [
        "5 Day Weather Forecast                           *******              ",
        "                                 ~             *---*******            ",
        "                                ~             *-----*******           ",
        "                         ~                   *-------*******          ",
        "                        __      _   _!__     *-------*******          ",
        "                   _   /  \_  _/ \  |::| ___ **-----********   ~      ",
        "                 _/ \_/^    \/   ^\/|::|\|:|  **---*****/^\_          ",
        "              /\/  ^ /  ^    / ^ ___|::|_|:|_/\_******/  ^  \         ",
        "             /  \  _/ ^ ^   /    |::|--|:|---|  \__/  ^     ^\___     ",
        "           _/_^  \/  ^    _/ ^   |::|::|:|-::| ^ /_  ^    ^  ^   \_   ",
        "          /   \^ /    /\ /       |::|--|:|:--|  /  \        ^      \  ",
        "         /     \/    /  /        |::|::|:|:-:| / ^  \  ^      ^     \ ",
        "   _Q   / _Q  _Q_Q  / _Q    _Q   |::|::|:|:::|/    ^ \   _Q      ^    ",
        "  /_\)   /_\)/_/\\)  /_\)  /_\)  |::|::|:|:::|          /_\)          ",
        "_O|/O___O|/O_OO|/O__O|/O__O|/O__________________________O|/O__________",
        "//////////////////////////////////////////////////////////////////////"
    ]

    var rain = [
        "      |       |        |       | |",
        " ' |   |   |     '  |      '      ",
        "              |           |     | ",
        " '     |  _,..--I--..,_ |         ",
        "   / _.-`` _,-`   `-,_ ``-._ \    ",
        "     `-,_,_,.,_   _,.,_._,-`      ",
        "|  | '   '     `Y` __ '     '     ",
        "  '|        ,-. I /  \       |  | ",
        " |    |    /   )I \  /     '   |  ",
        "'  '      /   / I_.''._           ",
        "|  |    ,l  .'..`      `.   ' |  |",
        " |     / | /   \        l         ",
        "      /, ''  .  \      ||   |   | ",
        " |  ' ||      |'|      ||   |     ",
        "'     ||      | |      ||       | ",
        "|     \|      | '.____,'/  |  |   ",
        "   |   |      |  |    |F   '    | ",
        " | '   |      |  | |\ |     ' |   ",
        "       |      |  | || |      |    ",
        "|  |   |      |  | || |    |    | ",
        "       |      |  | || |      |    ",
        " ' |   '.____,'  \_||_/   |    |  ",
        "         |/\|    [_][_]      |    ",
        "''''''''''''''''''''''''''''''''''"
    ];

    var clear = [
        "        \     (      /        ",
        "   `.    \     )    /    .'   ",
        "     `.   \   (    /   .'     ",
        "       `.  .-''''-.  .'       ",
        " `~._    .'/_    _\`.    _.~' ",
        "     `~ /  / \  / \  \ ~'     ",
        "_ _ _ _|  _\O/  \O/_  |_ _ _ _",
        "       | (_)  /\  (_) |       ",
        "    _.~ \  \      /  / ~._    ",
        " .~'     `. `.__.' .'     `~. ",
        "       .'  `-,,,,-'  `.       ",
        "     .'   /    )   \   `.     ",
        "   .'    /    (     \    `.   ",
        "        /      )     \        ",
        "              (               "
    ];

    var snow = [
        "    .--.            ",
        ".-./ ___\      ||   ",
        "`-'\|. .|      ||   ",
        "   __\=/__    .-.   ",
        " .'  \:/  `. /\/|   ",
        "/ /(  :  )\ V /||   ",
        "\_\(  :  ) `-' ||   ",
        " (_(__:__)   __||___",
        "   \  |  /  /      /",
        "   |__|__| (      ( ",
        "  (___V___) \______\\"
    ];

    var thunderstorm = [
        "                                        ___    ,''''''.                         ",
        "                                    ,'''   '''''      `.                        ",
        "                                   ,'        _.         `._                     ",
        "                                  ,'       ,'              `''''.               ",
        "                                 ,'    .-''`.    ,-'            `.              ",
        "                                ,'    (        ,'                :              ",
        "                              ,'     ,'           __,            `.             ",
        "                        ,'''''     .' ;-.    ,  ,'  \             `''''.        ",
        "                      ,'           `-(   `._(_,'     )_                `.       ",
        "                     ,'         ,---. \ @ ;   \ @ _,'                   `.      ",
        "                ,-'''         ,'      ,--'-    `;'                       `.     ",
        "               ,'            ,'      (      `. ,'                          `.   ",
        "               ;            ,'        \    _,','                            `.  ",
        "              ,'            ;          `--'  ,'                              `. ",
        "             ,'             ;          __    (                    ,           `.",
        "             ;              `____...  `78b   `.                  ,'           ,'",
        "             ;    ...----'''' )  _.-  .d8P    `.                ,'    ,'    ,'  ",
        "_....----''' '.        _..--'_.-:.-' .'        `.             ,''.   ,' `--'    ",
        "              `' mGk '' _.-'' .-'`-.:..___...--' `-._      ,-''   `-'           ",
        "        _.--'       _.-'    .'   .' .'               `'''''                     ",
        "  __.-''        _.-'     .-'   .'  /                                            ",
        " '          _.-' .-'  .-'        .'                                             ",
        "        _.-'  .-'  .-' .'  .'   /                                               ",
        "    _.-'      .-'   .-'  .'   .'                                                ",
        "_.-'       .-'    .'   .'    /                                                  ",
        "       _.-'    .-'   .'    .'                                                   ",
        "    .-'            .'                                                           "
    ];

    var clouds = [
        "                _                                       ",
        "              (`  ).                   _                ",
        "             (     ).              .:(`  )`.            ",
        ")           _(       '`.          :(   .    )           ",
        "        .=(`(      .   )     .--  `.  (    ) )          ",
        "       ((    (..__.:'-'   .+(   )   ` _`  ) )           ",
        "`.     `(       ) )       (   .  )     (   )  ._        ",
        "  )      ` __.:'   )     (   (   ))     `-'.-(`  )      ",
        ")  )  ( )       --'       `- __.'         :(      ))    ",
        ".-'  (_.'          .')                    `(    )  ))   ",
        "                  (_  )                     ` __.:'     ",
        "                                                        ",
        "--..,___.--,--'`,---..-.--+--.,,-,,..._.--..-._.-_:---.'"
    ];

    var entities = {
        '\\brain\\b' : rain,
        '\\bsnow\\b' : snow,
        '\\bclear\\b' : clear,
        '\\bthunderstorm\\b' : thunderstorm,
        '\\bclouds\\b' : clouds
    };

    var parse = function(str) {

        var regexp;
        for(regexp in entities) {
            if(new RegExp(regexp).test(str)) {
                return entities[regexp];
            }
        }

    };

    var weatherDisplay = document.getElementById('ascii-weather');
    var hourDisplay = document.getElementById('weather-hour');
    var animationTimer;

    AsciiMorph(weatherDisplay, {
        x: 0,
        y: 0
    });

    window.Forecast = window.Forecast || {

        show: function(desc, hr) {

            let ascii = parse(desc);

            if(!ascii) {
                return AsciiMorph.render(cover);
            }

            // Morph into new art
            //
            AsciiMorph.morph(ascii);

            // Update Time
            //
            hourDisplay.innerText = hr < 12 ? (hr + ':00 AM') : ((hr - 12) + ':00 PM');
        },

        get: function(query, cb) {

            $.get('/forecast/' + query)
            .done(function(data) {
                cb(data);
            })
            .fail(function(err) {
                console.log('err:', err)
            })
        },

        animate: function(list) {

            clearTimeout(animationTimer);

            var obj = list.shift();

            if(!obj) {
                return;
            }

            Forecast.show(obj.desc, obj.hr);

            animationTimer = setTimeout(function() {
                Forecast.animate(list)
            }, 3000)
        }
    };

    // Show "boilerplate"
    //
    Forecast.show();

})();